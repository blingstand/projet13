{% extends 'core/base.html' %}
{% block content %}
<section>
    <h2 class="mt-5 pl-5">Historique des contacts de {{owner.owner_name}} {{owner.owner_surname}}</h2>
    <article class="mt-5 container">
        <div class="row">
            <div class="col-2"></div>
            {% for elem in button_value %} <!-- affiche les boutons -->
            <div class="col-3 bg-primary text-center">
                <button id="{{elem.id}}" onclick="{{elem.function}}">{{elem.name}}</button>
            </div>
            {% endfor %}
            <div class="col-1"></div>
            <div class="col-12 mb-5 text-center">
                <button>imprimer</button>
            </div>
            <form id="my_form" action="" method="" name="my_form">
                {% csrf_token %} 
                <table id="histo_table" class="">
                    <tr class="col-12 text-center">
                        <td>&nbsp;</td>
                        {% for col in historic_cols %}
                        <td>{{col}}</td>
                        {% endfor %}
                    </tr>
                </table>
            </form>
        </div>
    </article>
</section>
{% load static %}
<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
<script type="text/javascript" src='{% static "sheet/js/utils.js" %}'> </script>
<script type="text/javascript">
    let table = document.getElementById('histo_table')
    const form = document.getElementById('my_form')
    const getCounter = function(){
        allTd = document.querySelectorAll('tr')
        return allTd.length  
    }
    const GetDatas = function(counter){
        keys = ["date", "select", "title", "object"]
        ids = ["id_date_"+counter, "id_select_"+counter, "id_title_"+counter, "id_area_"+counter]
        console.log(ids)
        value = {}
        for (id in ids){
            value[keys[id]] = document.getElementById(ids[id]).value
        }
        let whatToDo = function(data){
            console.log("Success")
        }
        sendDatasToServer(value, "{% url 'sheet:contact_owner' owner.id%}", whatToDo)
        console.log(value)



    }
    const SpecifyInput = function(tabInput, counter){
        //this function specifies the given input}
        date = tabInput[0]
        date.type = 'date'
        date.id = "id_date_" + counter
        select = tabInput[1]
        select.id = "id_select_" + counter
        options = [
        {'value' : "0", "name": "sélectionnez un type"},
        {'value' : "1", "name": "mail spa"},
        {'value' : "2", "name": "tel spa"},
        {'value' : "3", "name": "mail propriétaire"},
        {'value' : "4", "name": "tel propriétaire"},
        {'value' : "5", "name": "mail automatique"},
        ]
        for (opt of options){
            option = document.createElement('option')
            option.id = "id_option_" + counter
            option.value = opt.name
            option.innerHTML = opt.name
            select.appendChild(option)
        }
        title = tabInput[2]
        title.id = "id_title_" + counter
        title.classList.add("input-title")

        area = tabInput[3]
        area.id = "id_area_" + counter
        area.rows="2" 
        area.cols="33"
    }
    const Add = function (){
        //this function adds a new line in table
        let counter = getCounter()
        let tabInput = []

        tr = document.createElement('tr')
        tr.id = counter
        table.appendChild(tr)

        tdCheck = document.createElement('td')
        checkbox = document.createElement('input')
        checkbox.type = "checkbox"
        tr.appendChild(tdCheck)
        tdCheck.appendChild(checkbox)

        for (elem of ["input","select","input","textarea"]){
            td = document.createElement('td')
            td.classList.add('text-center')
            input = document.createElement(elem)
            tabInput.push(input)
            tr.appendChild(td) 
            td.appendChild(input)
        }
        lastTD = document.createElement('td')
        lastTD.classList.add('text-center')
        but = document.createElement('button')
        but.innerHTML = "valider"
        but.onclick = function(event){
            e = event || window.event;
            e.preventDefault()
            GetDatas(counter)

        }
        tr.appendChild(lastTD) 
        lastTD.appendChild(but)

        SpecifyInput(tabInput, counter)

    }
</script>
{% endblock  %}